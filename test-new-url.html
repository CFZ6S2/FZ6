<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Nueva URL del Backend</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #0f172a;
            color: #e2e8f0;
        }
        h1 { color: #60a5fa; }
        .test-box {
            background: #1e293b;
            border: 2px solid #334155;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #2563eb; }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .info { color: #60a5fa; }
        pre {
            background: #0f172a;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            border-left: 4px solid #3b82f6;
        }
        #results { margin-top: 20px; }
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            margin-left: 10px;
        }
        .badge-success { background: #10b981; color: white; }
        .badge-error { background: #ef4444; color: white; }
    </style>
</head>
<body>
    <h1>üß™ Test de Nueva URL del Backend</h1>

    <div class="test-box">
        <h2>URLs Configuradas</h2>
        <p><strong>‚ùå URL Antigua (ya no funciona):</strong></p>
        <pre>https://t2c06-production.up.railway.app</pre>

        <p><strong>‚úÖ URL Nueva (correcta):</strong></p>
        <pre id="new-url">https://fz6-production.up.railway.app</pre>
    </div>

    <div class="test-box">
        <h2>Tests R√°pidos</h2>
        <button onclick="testHealth()">üè• Test /health</button>
        <button onclick="testSecurityInfo()">üîí Test /security-info</button>
        <button onclick="testV1Info()">üìä Test /v1/info</button>
        <button onclick="testAll()">üöÄ Test Todo</button>
    </div>

    <div id="results"></div>

    <div class="test-box">
        <h2>üìù Instrucciones</h2>
        <ol>
            <li>Haz clic en "Test Todo" arriba</li>
            <li>Si ves <span class="success">‚úÖ todo verde</span>, el backend funciona perfectamente</li>
            <li>Ahora solo falta redesplegar el frontend:
                <pre>firebase deploy --only hosting</pre>
            </li>
            <li>Despu√©s del deploy, <strong>Ctrl+Shift+R</strong> en tucitasegura.com</li>
        </ol>
    </div>

    <script>
        const BASE_URL = 'https://fz6-production.up.railway.app';

        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-box ${type}`;
            div.innerHTML = message;
            results.appendChild(div);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        async function testEndpoint(name, path) {
            log(`üß™ Testing ${name}...`, 'info');
            try {
                const response = await fetch(`${BASE_URL}${path}`);
                const data = await response.json();

                if (response.ok) {
                    log(`<h3 class="success">‚úÖ ${name} - SUCCESS</h3>
                         <p>Status: ${response.status}</p>
                         <pre>${JSON.stringify(data, null, 2)}</pre>`, 'success');
                    return true;
                } else {
                    log(`<h3 class="error">‚ùå ${name} - Failed</h3>
                         <p>Status: ${response.status}</p>
                         <pre>${JSON.stringify(data, null, 2)}</pre>`, 'error');
                    return false;
                }
            } catch (error) {
                log(`<h3 class="error">‚ùå ${name} - ERROR</h3>
                     <p>${error.message}</p>
                     <p>Posibles causas:</p>
                     <ul>
                         <li>CORS bloqueado (pero deber√≠a funcionar)</li>
                         <li>Backend offline</li>
                         <li>Network error</li>
                     </ul>`, 'error');
                return false;
            }
        }

        async function testHealth() {
            clearResults();
            await testEndpoint('Health Check', '/health');
        }

        async function testSecurityInfo() {
            clearResults();
            await testEndpoint('Security Info', '/security-info');
        }

        async function testV1Info() {
            clearResults();
            await testEndpoint('API v1 Info', '/v1/info');
        }

        async function testAll() {
            clearResults();
            log('<h2>üöÄ Ejecutando todos los tests...</h2>', 'info');

            const results = [];
            results.push(await testEndpoint('Health Check', '/health'));
            results.push(await testEndpoint('Security Info', '/security-info'));
            results.push(await testEndpoint('API v1 Info', '/v1/info'));
            results.push(await testEndpoint('CSRF Token', '/api/csrf-token'));

            const success = results.filter(r => r).length;
            const total = results.length;

            if (success === total) {
                log(`<h2 class="success">üéâ ¬°PERFECTO! ${success}/${total} tests pasados</h2>
                     <p>El backend est√° funcionando correctamente con la nueva URL.</p>
                     <p><strong>Siguiente paso:</strong> Redesplegar el frontend para que use esta URL.</p>
                     <pre>firebase deploy --only hosting</pre>`, 'success');
            } else {
                log(`<h2 class="error">‚ö†Ô∏è ${success}/${total} tests pasados</h2>
                     <p>Algunos tests fallaron. Revisa los errores arriba.</p>`, 'error');
            }
        }

        // Auto-test on load
        window.addEventListener('load', () => {
            setTimeout(testAll, 500);
        });
    </script>
</body>
</html>
