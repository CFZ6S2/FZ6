import{a as s,d as c}from"./firebase-config-env-BtJ4KElt.js";/* empty css               */import"./firebase-appcheck-B5Dlx5A0.js";import{onAuthStateChanged as l}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";import{doc as u,updateDoc as m,serverTimestamp as a}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";import"./theme-BOByySXs.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-functions.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app-check.js";import"./logger-CnI7WBtq.js";let n=null;l(s,e=>{e?(n=e,document.getElementById("loadingOverlay").classList.add("hidden"),h()):window.location.href="/login.html"});function h(){paypal.Buttons({style:{shape:"rect",color:"gold",layout:"vertical",label:"paypal",height:50},createOrder:function(e,t){return t.order.create({purchase_units:[{description:"Seguro Anti-Plant√≥n TuCitaSegura",amount:{currency_code:"EUR",value:"120.00"},custom_id:n.uid}]})},onApprove:async function(e,t){document.getElementById("loadingOverlay").classList.remove("hidden");try{const o=await t.order.authorize();console.log("Payment authorized (hold placed):",o);const d=o.purchase_units[0].payments.authorizations[0].id,i=u(c,"users",n.uid);await m(i,{hasAntiGhostingInsurance:!0,insuranceAuthorizationId:d,insuranceOrderId:e.orderID,insurancePurchaseDate:a(),insuranceAmount:120,insuranceStatus:"authorized",updatedAt:a()}),console.log("Firestore updated successfully with authorization ID"),document.getElementById("loadingOverlay").classList.add("hidden"),document.getElementById("successModal").classList.remove("hidden")}catch(o){console.error("Error processing authorization:",o),document.getElementById("loadingOverlay").classList.add("hidden"),r("Error al procesar tu seguro. Por favor contacta soporte con tu ID de orden: "+e.orderID)}},onError:function(e){console.error("PayPal error:",e),document.getElementById("loadingOverlay").classList.add("hidden"),r("Hubo un error al procesar el pago. Por favor intenta nuevamente.")},onCancel:function(e){console.log("Payment cancelled:",e),document.getElementById("loadingOverlay").classList.add("hidden"),r("Cancelaste el proceso de pago. Tu seguro no fue activado.")}}).render("#paypal-button-container")}function r(e){document.getElementById("errorMessage").textContent=e,document.getElementById("errorModal").classList.remove("hidden")}window.closeErrorModal=function(){document.getElementById("errorModal").classList.add("hidden")};window.redirectToSearch=function(){window.location.href="/buscar-usuarios.html"};
