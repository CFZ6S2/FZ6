import{a as i,d as l}from"./firebase-config-env-BtJ4KElt.js";/* empty css               */import"./error-fixes-B-QQl9aC.js";import"./firebase-appcheck-B5Dlx5A0.js";import{onAuthStateChanged as m,signOut as u}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";import{getDoc as p,doc as g,addDoc as E,collection as f,serverTimestamp as y}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";import{s as r}from"./utils-B649B8Z6.js";import{l as v}from"./theme-BOByySXs.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-functions.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app-check.js";import"./logger-CnI7WBtq.js";let c=null,e=null;m(i,async t=>{if(!t){window.location.href="/login.html";return}c=t;try{const n=await p(g(l,"users",t.uid));if(n.exists()){if(e={id:n.id,...n.data()},v(e),document.getElementById("userAlias").textContent=e.alias||"Usuario",e.photoURL){const o=sanitizer.url(e.photoURL);if(o)document.getElementById("userAvatar").innerHTML=`<img src="${o}" class="w-full h-full rounded-full object-cover">`;else{const d=(e.alias||e.email||"U")[0].toUpperCase();document.getElementById("userAvatar").textContent=d}}else{const o=(e.alias||e.email||"U")[0].toUpperCase();document.getElementById("userAvatar").textContent=o}if(e.gender==="femenino"){const o=document.getElementById("sos-section");o.classList.remove("hidden"),o.classList.add("flex")}document.getElementById("loading").classList.add("hidden"),document.getElementById("content").classList.remove("hidden")}}catch(n){console.error("Error loading user data:",n),r("Error al cargar datos de usuario","error")}});document.getElementById("logoutBtn").addEventListener("click",async()=>{try{await u(i),window.location.href="/login.html"}catch(t){console.error("Error signing out:",t),r("Error al cerrar sesiÃ³n","error")}});const a=document.getElementById("sos-button"),s=document.getElementById("sos-modal"),h=document.getElementById("cancel-sos"),B=document.getElementById("confirm-sos"),L=document.getElementById("sos-activated-screen");a&&a.addEventListener("click",()=>{s.classList.remove("opacity-0","pointer-events-none")});h.addEventListener("click",()=>{s.classList.add("opacity-0","pointer-events-none")});B.addEventListener("click",async()=>{s.classList.add("opacity-0","pointer-events-none"),L.classList.remove("opacity-0","pointer-events-none");try{await E(f(l,"sos_alerts"),{userId:c.uid,userAlias:e.alias,userEmail:e.email,userPhone:e.phone||"No disponible",timestamp:y(),status:"active",location:e.location||null}),console.log("SOS Alert sent to Firebase"),r("Alerta SOS enviada. El equipo de seguridad ha sido notificado.","info")}catch(t){console.error("Error sending SOS alert:",t),r("Error al enviar alerta SOS","error")}});document.getElementById("manageBlocksBtn").addEventListener("click",()=>{r("Funcionalidad en desarrollo","info")});
