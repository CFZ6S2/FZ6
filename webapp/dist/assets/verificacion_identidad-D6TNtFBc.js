import{a as E,d as p,s as m}from"./firebase-config-env-BtJ4KElt.js";/* empty css               */import{getDoc as L,doc as h,updateDoc as I,serverTimestamp as b}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";import{ref as u,uploadBytes as f,getDownloadURL as g}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";import{s as o}from"./utils-B649B8Z6.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-functions.js";let s=null,v=null,d=null,r=null,l=null;document.addEventListener("DOMContentLoaded",async()=>{if(s=E.currentUser,!s){window.location.href="login.html";return}try{const e=await L(h(p,"users",s.uid));if(e.exists()){if(v=e.data(),v.isVerified){o("Tu identidad ya está verificada","success"),setTimeout(()=>window.location.href="perfil.html",2e3);return}v.verificationStatus==="pending"&&(document.getElementById("verificationStatus").innerHTML='<i class="fas fa-clock mr-1"></i>En Revisión',document.getElementById("verificationStatus").classList.add("bg-yellow-500/30"),o("Tu verificación está en proceso de revisión","info"))}}catch(e){console.error("Error cargando usuario:",e)}P()});function P(){["uploadFrontArea","uploadBackArea","uploadSelfieArea"].forEach(e=>{const t=document.getElementById(e);t&&(t.addEventListener("dragover",i=>{i.preventDefault(),t.classList.add("dragover")}),t.addEventListener("dragleave",()=>{t.classList.remove("dragover")}),t.addEventListener("drop",i=>{i.preventDefault(),t.classList.remove("dragover");const n=i.dataTransfer.files;if(n.length>0){const a=n[0];e==="uploadFrontArea"?handleFrontUpload({target:{files:[a]}}):e==="uploadBackArea"?handleBackUpload({target:{files:[a]}}):e==="uploadSelfieArea"&&handleSelfieUpload({target:{files:[a]}})}}))})}window.handleFrontUpload=function(e){const t=e.target.files[0];if(t){if(t.size>10*1024*1024){o("El archivo es muy grande (máx 10 MB)","error");return}if(!t.type.startsWith("image/")&&t.type!=="application/pdf"){o("Solo imágenes o PDF","error");return}if(d=t,t.type.startsWith("image/")){const i=new FileReader;i.onload=n=>{document.getElementById("frontImage").src=n.target.result,document.getElementById("frontPlaceholder").classList.add("hidden"),document.getElementById("frontPreview").classList.remove("hidden")},i.readAsDataURL(t)}else document.getElementById("frontImage").src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="%23ef4444" d="M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48z"/></svg>',document.getElementById("frontPlaceholder").classList.add("hidden"),document.getElementById("frontPreview").classList.remove("hidden");c()}};window.handleBackUpload=function(e){const t=e.target.files[0];if(t){if(t.size>10*1024*1024){o("El archivo es muy grande (máx 10 MB)","error");return}if(!t.type.startsWith("image/")&&t.type!=="application/pdf"){o("Solo imágenes o PDF","error");return}if(r=t,t.type.startsWith("image/")){const i=new FileReader;i.onload=n=>{document.getElementById("backImage").src=n.target.result,document.getElementById("backPlaceholder").classList.add("hidden"),document.getElementById("backPreview").classList.remove("hidden")},i.readAsDataURL(t)}else document.getElementById("backImage").src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="%23ef4444" d="M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48z"/></svg>',document.getElementById("backPlaceholder").classList.add("hidden"),document.getElementById("backPreview").classList.remove("hidden");c()}};window.handleSelfieUpload=function(e){const t=e.target.files[0];if(!t)return;if(t.size>10*1024*1024){o("El archivo es muy grande (máx 10 MB)","error");return}if(!t.type.startsWith("image/")){o("Solo imágenes","error");return}l=t;const i=new FileReader;i.onload=n=>{document.getElementById("selfieImage").src=n.target.result,document.getElementById("selfiePlaceholder").classList.add("hidden"),document.getElementById("selfiePreview").classList.remove("hidden")},i.readAsDataURL(t),y()};window.removeFront=function(e){e.stopPropagation(),d=null,document.getElementById("frontPreview").classList.add("hidden"),document.getElementById("frontPlaceholder").classList.remove("hidden"),document.getElementById("frontInput").value="",c()};window.removeBack=function(e){e.stopPropagation(),r=null,document.getElementById("backPreview").classList.add("hidden"),document.getElementById("backPlaceholder").classList.remove("hidden"),document.getElementById("backInput").value="",c()};window.removeSelfie=function(e){e.stopPropagation(),l=null,document.getElementById("selfiePreview").classList.add("hidden"),document.getElementById("selfiePlaceholder").classList.remove("hidden"),document.getElementById("selfieInput").value="",y()};function c(){const e=document.getElementById("continueToSelfieBtn");d&&r?(e.disabled=!1,e.classList.remove("opacity-50","cursor-not-allowed")):(e.disabled=!0,e.classList.add("opacity-50","cursor-not-allowed"))}function y(){const e=document.getElementById("submitVerificationBtn");l?(e.disabled=!1,e.classList.remove("opacity-50","cursor-not-allowed")):(e.disabled=!0,e.classList.add("opacity-50","cursor-not-allowed"))}window.continueToSelfie=function(){document.getElementById("step1").classList.remove("active"),document.getElementById("step1").classList.add("completed"),document.getElementById("step1Status").classList.remove("hidden"),document.getElementById("step2").classList.add("active"),document.getElementById("selfieSection").classList.remove("hidden"),document.getElementById("selfieSection").scrollIntoView({behavior:"smooth"}),o("¡Paso 1 completado! Ahora toma tu selfie","success")};window.submitVerification=async function(){const e=document.getElementById("loadingModal");e.classList.remove("hidden"),e.classList.add("flex");try{const t=u(m,`verification_docs/${s.uid}/front_${Date.now()}`),i=u(m,`verification_docs/${s.uid}/back_${Date.now()}`),n=u(m,`verification_docs/${s.uid}/selfie_${Date.now()}`);await Promise.all([f(t,d),f(i,r),f(n,l)]);const[a,w,B]=await Promise.all([g(t),g(i),g(n)]);await I(h(p,"users",s.uid),{verificationStatus:"pending",verificationDocuments:{front:a,back:w,selfie:B,submittedAt:b()}}),e.classList.add("hidden"),document.getElementById("step2").classList.remove("active"),document.getElementById("step2").classList.add("completed"),document.getElementById("step2Status").classList.remove("hidden"),document.getElementById("step3").classList.add("active"),document.getElementById("verificationStatus").innerHTML='<i class="fas fa-clock mr-1"></i>En Revisión',document.getElementById("verificationStatus").classList.add("bg-yellow-500/30"),o("¡Verificación enviada! Revisaremos tu solicitud en 24-48 horas","success"),setTimeout(()=>{window.location.href="perfil.html"},3e3)}catch(t){console.error("Error submitting verification:",t),e.classList.add("hidden"),o("Error enviando verificación. Inténtalo de nuevo.","error")}};
