import{a as g,d as m}from"./firebase-config-env-BtJ4KElt.js";/* empty css               */import"./firebase-appcheck-B5Dlx5A0.js";import{getDoc as f,doc as p,updateDoc as y,query as E,collection as h,where as x,getDocs as v}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";import{onAuthStateChanged as b}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";import{l as w}from"./theme-BOByySXs.js";import{s as c}from"./utils-B649B8Z6.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-functions.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app-check.js";import"./logger-CnI7WBtq.js";function I(e,t){const r=e.replace(/[^a-zA-Z0-9]/g,"").toUpperCase().substring(0,6),a=t.substring(0,6).toUpperCase();return`${r}${a}`}const o={BRONZE:{referralsNeeded:1,reward:"Free 1 month membership",badge:"Embajador Bronce",icon:"",discountDays:30},SILVER:{referralsNeeded:5,reward:"Free 3 months membership + VIP event access",badge:"Embajador Plata",icon:"",discountDays:90,vipEventAccess:!0},GOLD:{referralsNeeded:10,reward:"Free 6 months membership + VIP priority",badge:"Embajador Oro",icon:"",discountDays:180,vipEventAccess:!0,priority:!0},PLATINUM:{referralsNeeded:25,reward:"Free 1 year membership + all perks",badge:"Embajador Platino",icon:"",discountDays:365,vipEventAccess:!0,priority:!0,allPerks:!0}};function R(e){return e>=o.PLATINUM.referralsNeeded?{tier:"PLATINUM",...o.PLATINUM}:e>=o.GOLD.referralsNeeded?{tier:"GOLD",...o.GOLD}:e>=o.SILVER.referralsNeeded?{tier:"SILVER",...o.SILVER}:e>=o.BRONZE.referralsNeeded?{tier:"BRONZE",...o.BRONZE}:null}function L(e){const t=[{tier:"BRONZE",...o.BRONZE},{tier:"SILVER",...o.SILVER},{tier:"GOLD",...o.GOLD},{tier:"PLATINUM",...o.PLATINUM}];for(const r of t)if(e<r.referralsNeeded)return{...r,remaining:r.referralsNeeded-e};return null}function N(e){const t={total:e.length,pending:0,completed:0,active:0,totalRewardsEarned:0};return e.forEach(r=>{r.status==="pending"&&t.pending++,r.status==="completed"&&t.completed++,r.status==="active"&&t.active++,r.rewardEarned&&(t.totalRewardsEarned+=r.rewardValue||0)}),t}async function C(e,t){const r=`隆nete a TuCitaSegura con mi c贸digo de invitaci贸n ${e} y comienza a encontrar relaciones serias! `,a=`${window.location.origin}?ref=${e}`;if(navigator.share)try{return await navigator.share({title:"Invitaci贸n a TuCitaSegura",text:r,url:a}),{success:!0,method:"native"}}catch(n){n.name!=="AbortError"&&console.error("Error sharing:",n)}try{return await navigator.clipboard.writeText(`${r}
${a}`),{success:!0,method:"clipboard"}}catch(n){return console.error("Error copying to clipboard:",n),{success:!1,method:null}}}let u=null,d=null,i="";b(g,async e=>{if(!e){window.location.href="../index.html";return}u=e,await T()});async function T(){try{const e=await f(p(m,"users",u.uid));if(!e.exists()){c("Usuario no encontrado","error");return}d=e.data(),w(d),d.referralCode?i=d.referralCode:(i=I(d.alias,u.uid),await y(p(m,"users",u.uid),{referralCode:i,referralStats:{totalReferrals:0,completedReferrals:0,pendingReferrals:0,currentTier:null}})),document.getElementById("referralCode").textContent=i,await B(),await $()}catch(e){console.error("Error loading user data:",e),c("Error al cargar datos","error")}}async function B(){try{const e=E(h(m,"referrals"),x("referrerId","==",u.uid)),r=(await v(e)).docs.map(l=>({id:l.id,...l.data()})),a=N(r),n=R(a.completed),s=L(a.completed);if(document.getElementById("totalReferrals").textContent=a.total,document.getElementById("pendingReferrals").textContent=a.pending,document.getElementById("completedReferrals").textContent=a.completed,document.getElementById("currentTier").textContent=n?`${n.icon} ${n.tier}`:"Ninguno",s){document.getElementById("progressCard").style.display="block";const l=a.completed/s.referralsNeeded*100;document.getElementById("progressBar").style.width=`${l}%`,document.getElementById("progressPercentage").textContent=`${Math.round(l)}%`,document.getElementById("progressText").textContent=`${a.completed} / ${s.referralsNeeded} referidos`,document.getElementById("progressDescription").textContent=`Te faltan ${s.remaining} referidos para alcanzar el nivel ${s.badge}`}D(r)}catch(e){console.error("Error loading referrals:",e),c("Error al cargar referidos","error")}}function $(){const e=document.getElementById("tiersContainer");e.innerHTML="",[{tier:"BRONZE",...o.BRONZE},{tier:"SILVER",...o.SILVER},{tier:"GOLD",...o.GOLD},{tier:"PLATINUM",...o.PLATINUM}].forEach(r=>{const a=document.createElement("div");a.className="tier-card glass rounded-xl p-6 text-center",a.innerHTML=`
          <div class="text-5xl mb-3">${r.icon}</div>
          <div class="font-bold text-lg mb-2">${r.badge}</div>
          <div class="text-sm text-gray-600 mb-3">${r.referralsNeeded} referidos</div>
          <div class="text-xs text-gray-500">${r.reward}</div>
        `,e.appendChild(a)})}function D(e){const t=document.getElementById("referralsHistory");if(e.length===0){t.innerHTML=`
          <div class="text-center text-gray-500 py-8">
            <i class="fas fa-inbox text-6xl mb-4 opacity-50"></i>
            <p>A煤n no tienes referidos</p>
          </div>
        `;return}t.innerHTML="",e.forEach(r=>{const a={pending:"bg-yellow-100 text-yellow-800",completed:"bg-green-100 text-green-800",active:"bg-blue-100 text-blue-800"},n={pending:"fa-clock",completed:"fa-check-circle",active:"fa-user-check"},s=document.createElement("div");s.className="flex items-center justify-between p-4 border-b border-gray-200 hover:bg-gray-50 transition",s.innerHTML=`
          <div class="flex items-center gap-4">
            <i class="fas fa-user-circle text-3xl text-purple-600"></i>
            <div>
              <div class="font-semibold">${r.referredAlias||"Usuario"}</div>
              <div class="text-sm text-gray-500">
                ${r.createdAt?new Date(r.createdAt.toDate()).toLocaleDateString():"Fecha desconocida"}
              </div>
            </div>
          </div>
          <div>
            <span class="px-3 py-1 rounded-full text-xs font-semibold ${a[r.status]||"bg-gray-100 text-gray-800"}">
              <i class="fas ${n[r.status]||"fa-question"} mr-1"></i>
              ${r.status||"pendiente"}
            </span>
          </div>
        `,t.appendChild(s)})}document.getElementById("copyCodeBtn").addEventListener("click",async()=>{try{await navigator.clipboard.writeText(i),c("C贸digo copiado al portapapeles","success")}catch{c("Error al copiar c贸digo","error")}});document.getElementById("shareCodeBtn").addEventListener("click",async()=>{const e=await C(i,d.alias);e.success?e.method==="clipboard"?c("C贸digo copiado al portapapeles","success"):c("C贸digo compartido exitosamente","success"):c("Error al compartir c贸digo","error")});document.getElementById("shareWhatsappBtn").addEventListener("click",()=>{const e=`隆nete a TuCitaSegura con mi c贸digo de invitaci贸n ${i} y comienza a encontrar relaciones serias! `,t=`${window.location.origin}?ref=${i}`,r=`https://wa.me/?text=${encodeURIComponent(e+`
`+t)}`;window.open(r,"_blank")});
