import{a as l,d as v}from"./firebase-config-env-BtJ4KElt.js";/* empty css               */import"./firebase-appcheck-B5Dlx5A0.js";import{s as y}from"./sanitizer-CcqdHDpm.js";import{v as c,R as f,s as E,h as I,a as D}from"./network-error-handler-B4Bzh62h.js";import{l as p}from"./logger-CnI7WBtq.js";import{i as L}from"./demo-mode-hXQ_XCDZ.js";import{createUserWithEmailAndPassword as x,sendEmailVerification as B}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";import{setDoc as C,doc as M,serverTimestamp as h}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";import{s as R}from"./error-handler-C1-yvVyz.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-functions.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";import"https://www.gstatic.com/firebasejs/10.12.2/firebase-app-check.js";import"./utils-B649B8Z6.js";R();const m=new Date,S=new Date(m.getFullYear()-18,m.getMonth(),m.getDate());document.getElementById("birthDate").max=S.toISOString().split("T")[0];function s(r,e="info"){const t=document.createElement("div");t.className=`glass-strong rounded-lg p-4 shadow-lg transform transition-all duration-300 ${e==="success"?"border-l-4 border-green-500":e==="error"?"border-l-4 border-red-500":e==="warning"?"border-l-4 border-yellow-500":"border-l-4 border-blue-500"}`;const i=e==="success"?"fa-check-circle":e==="error"?"fa-exclamation-circle":e==="warning"?"fa-exclamation-triangle":"fa-info-circle",d=e==="success"?"text-green-400":e==="error"?"text-red-400":e==="warning"?"text-yellow-400":"text-blue-400",n=y.text(r);t.innerHTML=`
        <div class="flex items-center gap-3">
          <i class="fas ${i} ${d} text-xl"></i>
          <span class="text-white">${n}</span>
        </div>
      `,document.getElementById("toastContainer").appendChild(t),setTimeout(()=>{t.style.opacity="0",t.style.transform="translateX(100%)",setTimeout(()=>t.remove(),300)},5e3)}document.getElementById("togglePassword").addEventListener("click",function(){const r=document.getElementById("password"),e=this.querySelector("i");r.type==="password"?(r.type="text",e.classList.remove("fa-eye"),e.classList.add("fa-eye-slash")):(r.type="password",e.classList.remove("fa-eye-slash"),e.classList.add("fa-eye"))});document.getElementById("password").addEventListener("input",function(){const r=this.value,e=document.getElementById("passwordStrength");if(r.length===0){e.innerHTML="";return}let t=0,i="";r.length>=8&&t++,/[a-z]/.test(r)&&/[A-Z]/.test(r)&&t++,/\d/.test(r)&&t++,/[^a-zA-Z\d]/.test(r)&&t++,t<=1?i='<span class="text-red-400">D√©bil</span>':t===2?i='<span class="text-yellow-400">Media</span>':t===3?i='<span class="text-blue-400">Buena</span>':i='<span class="text-green-400">Muy fuerte</span>',e.innerHTML=`Seguridad: ${i}`});function w(r){const e=new Date,t=new Date(r),i=e.getFullYear()-t.getFullYear(),d=e.getMonth()-t.getMonth();return d<0||d===0&&e.getDate()<t.getDate()?i-1:i}document.getElementById("birthDate").addEventListener("change",function(){const r=w(this.value),e=document.getElementById("ageError");r<18?(e.classList.remove("hidden"),this.setCustomValidity("Debes tener al menos 18 a√±os")):(e.classList.add("hidden"),this.setCustomValidity(""))});document.getElementById("registerForm").addEventListener("submit",async function(r){r.preventDefault();const e=document.getElementById("email").value.trim(),t=document.getElementById("password").value,i=document.getElementById("confirmPassword").value,d=document.getElementById("birthDate").value,n=document.getElementById("registerButton");if(!c.email(e)){s("Por favor ingresa un email v√°lido","error");return}const u=c.password(t);if(!u.isValid){s("Contrase√±a inv√°lida: "+u.errors.join(", "),"error");return}if(!f.register.tryRequest(e)){const a=f.register.getRetryAfter(e);E("registro",a);return}if(t!==i){s("Las contrase√±as no coinciden","error");return}if(!c.age(d)){s("Debes tener al menos 18 a√±os para registrarte","error");return}w(d),n.disabled=!0,n.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i>Creando cuenta...';try{const o=(await x(l,e,t)).user;await B(o),await C(M(v,"users",o.uid),{uid:o.uid,email:e,alias:"",gender:"",birthDate:d,userRole:"regular",hasActiveSubscription:!1,subscriptionId:"",hasAntiGhostingInsurance:!1,insurancePaymentId:"",isConcierge:!1,conciergeStatus:"",conciergeSubscriptionId:"",photoURL:"",photos:[],bio:"",municipio:"",location:null,reputation:"BRONCE",theme:"purple",emailVerified:!1,isOnline:!1,createdAt:h(),lastActivity:h()}),n.disabled=!0,n.innerHTML='<i class="fas fa-check-circle mr-2"></i>¬°Cuenta Creada!',n.classList.remove("from-blue-500","to-blue-700"),n.classList.add("from-green-500","to-green-700"),s("‚úÖ ¬°Cuenta creada exitosamente!","success"),s("üìß Revisa tu correo para verificar tu cuenta","info"),s("‚è≥ Redirigiendo en 5 segundos...","info"),await l.signOut(),setTimeout(()=>{window.location.href="/login.html?registered=true"},5e3)}catch(a){if(p.error("Registration error:",a),a.code==="auth/network-request-failed"||a.code==="auth/internal-error"||a.code==="auth/unavailable"||a.code==="auth/timeout"){const o=I(a,"registro");if(D(o,s),console.error("[REGISTRATION NETWORK ERROR]",{code:a.code,hostname:location.hostname,protocol:location.protocol,online:navigator.onLine,timestamp:new Date().toISOString()}),o.isDomainIssue)try{console.log("üîÑ Activando modo demo autom√°ticamente...");const b={uid:"demo_"+Date.now(),email:e,displayName:e.split("@")[0],role:"user",subscription:"free",createdAt:new Date().toISOString(),isDemo:!0,demoMessage:"Modo demo activado - dominio no autorizado en Firebase"};localStorage.setItem("demoUser",JSON.stringify(b)),localStorage.setItem("demoToken","demo_token_"+Date.now()),localStorage.setItem("isDemoMode","true"),s("‚úÖ Modo demo activado autom√°ticamente","success"),s("üéØ Cuenta demo creada exitosamente","info"),s("üí° Nota: Est√°s en modo demo - funcionalidad limitada","warning"),setTimeout(()=>{window.location.href="/perfil.html?demo=true&auto=true"},3e3);return}catch(g){console.error("Demo mode error:",g),s("‚ùå Error incluso en modo demo","error")}}else{let o="Error al crear la cuenta";switch(a.code){case"auth/email-already-in-use":o="Este correo electr√≥nico ya est√° registrado";break;case"auth/invalid-email":o="Correo electr√≥nico inv√°lido";break;case"auth/operation-not-allowed":o="Registro no permitido. Contacta soporte";break;case"auth/weak-password":o="La contrase√±a es demasiado d√©bil";break;default:o=a.message}s(o,"error")}if(n.disabled=!1,n.innerHTML='<i class="fas fa-user-plus mr-2"></i>Crear Cuenta',a.code?.startsWith("permission-denied")||a.code?.startsWith("firestore"))try{await l.currentUser?.delete()}catch(o){p.error("Error cleaning up user:",o)}}});L();
