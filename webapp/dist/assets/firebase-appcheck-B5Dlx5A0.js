import{initializeAppCheck as b,ReCaptchaEnterpriseProvider as y}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-app-check.js";import{b as u}from"./firebase-config-env-BtJ4KElt.js";import{l as e}from"./logger-CnI7WBtq.js";const E="modulepreload",S=function(a){return"/"+a},k={},C=function(c,o,t){let n=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),r=l?.nonce||l?.getAttribute("nonce");n=Promise.allSettled(o.map(s=>{if(s=S(s),s in k)return;k[s]=!0;const d=s.endsWith(".css"),g=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${g}`))return;const i=document.createElement("link");if(i.rel=d?"stylesheet":E,d||(i.as="script"),i.crossOrigin="",i.href=s,r&&i.setAttribute("nonce",r),document.head.appendChild(i),d)return new Promise((A,w)=>{i.addEventListener("load",A),i.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${s}`)))})}))}function m(l){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=l,window.dispatchEvent(r),!r.defaultPrevented)throw l}return n.then(l=>{for(const r of l||[])r.status==="rejected"&&m(r.reason);return c().catch(m)})},h="6LdlmB8sAAAAAMHn-yHoJIAwg2iVQMIXCKtDq7eb",T=["tucitasegura-129cc.web.app","tucitasegura-129cc.firebaseapp.com","traext5oyy6q.vercel.app","vercel.app","tucitasegura.com","www.tucitasegura.com"],v=T.some(a=>location.hostname===a||location.hostname.includes(a)),f=location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname.startsWith("10.")||location.hostname.startsWith("192.168.");e.info(`üöÄ Entorno: ${location.hostname}`);function R(){const a=[];for(let c=0;c<localStorage.length;c++){const o=localStorage.key(c);o&&(o.includes("firebase")||o.includes("appCheck")||o.includes("fac")||o.includes("heartbeat")||o.includes("firebaseLocalStorage"))&&a.push(o)}return a}async function _(){if(!window.indexedDB)return;const c=["firebaseLocalStorageDb","firebase-app-check-database","firebase-heartbeat-database","firebase-installations-database"].map(o=>new Promise(t=>{const n=indexedDB.deleteDatabase(o);n.onsuccess=()=>t({name:o,ok:!0}),n.onerror=()=>t({name:o,ok:!1}),n.onblocked=()=>t({name:o,ok:!1})}));return Promise.all(c)}async function I(){R().forEach(t=>{try{localStorage.removeItem(t),e.debug("Removed localStorage:",t)}catch(n){e.debug("Could not remove localStorage key",t,n.message)}});const c=[];for(let t=0;t<sessionStorage.length;t++){const n=sessionStorage.key(t);n&&(n.includes("firebase")||n.includes("appCheck")||n.includes("fac")||n.includes("heartbeat"))&&c.push(n)}c.forEach(t=>{try{sessionStorage.removeItem(t),e.debug("Removed sessionStorage:",t)}catch(n){e.debug("Could not remove sessionStorage key",t,n.message)}});const o=await _();return e.info("üßπ IndexedDB cleared results:",o),!0}window.clearAppCheckThrottle=async function({reload:a=!0}={}){return e.info("üßπ Clearing App Check state..."),await I(),e.success("‚úÖ App Check state cleared locally. Si enforcement estaba activo, recu√©rdalo en Firebase Console."),a&&(e.info("üîÅ Reloading page to apply changes..."),setTimeout(()=>location.reload(),800)),!0};window.detectAppCheckThrottled=function(){for(let a=0;a<localStorage.length;a++){const c=localStorage.key(a);if(!c)continue;const o=localStorage.getItem(c)||"";if(o.includes("appCheck/throttled")||o.includes("Requests throttled"))return!0}return!1};let p=null;async function D(){if(!v){e.warn("‚ö†Ô∏è  App Check DESACTIVADO: dominio no permitido:",location.hostname),window._appCheckInstance=null;return}if(f&&!enableDebugToken){e.info("‚ö†Ô∏è  App Check DESACTIVADO en desarrollo (no hay debug token configurado)."),window._appCheckInstance=null;return}if(window.detectAppCheckThrottled&&window.detectAppCheckThrottled()){e.error("üö® App Check parece throttled (bloqueo 24h). Llama a clearAppCheckThrottle() o abre /webapp/clear-appcheck-throttle.html para limpiar estado local."),window._appCheckInstance=null;return}if(location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname.startsWith("192.168.")||location.hostname.startsWith("10.")){e.info(`üõ°Ô∏è LAN/Localhost detectado (${location.hostname}): App Check deshabilitado para evitar conflictos.`),window._appCheckInstance=null;return}try{if(!u||!u.name){e.warn("‚ö†Ô∏è Firebase app no est√° listo. App Check deshabilitado."),window._appCheckInstance=null;return}e.info("üîê Inicializando App Check..."),p=b(u,{provider:new y(h),isTokenAutoRefreshEnabled:!0}),e.success("‚úÖ App Check inicializado correctamente"),e.info(`üìç Modo: ${f?"DESARROLLO":"PRODUCCI√ìN"} (${location.hostname})`),location.hostname==="tucitasegura.com"&&(e.info("üìù Si ves errores 403: Configura tucitasegura.com en Google Cloud Console"),e.info("üîó https://console.cloud.google.com/security/recaptcha ‚Üí Edita key 6LfdTvQrAAAAA..."))}catch(t){t.message&&(t.message.includes("recaptcha")||t.message.includes("ReCAPTCHA")||t.code==="appCheck/recaptcha-error")?(e.warn("‚ö†Ô∏è  App Check: ReCAPTCHA no disponible (continuando sin App Check)"),f&&e.info("üí° Para desarrollo: Configura un debug token o usa localhost")):e.error("‚ùå Error inicializando App Check:",t.message),e.info("‚úÖ La aplicaci√≥n funciona normalmente sin App Check"),p=null}window._appCheckInstance=p;const o=document.createElement("style");o.innerHTML=`
    .grecaptcha-badge { 
      visibility: hidden !important;
      opacity: 0 !important;
      pointer-events: none !important;
    }
  `,document.head.appendChild(o)}(async function(){await D();const c=location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname.startsWith("10.")||location.hostname.startsWith("192.168.");!c&&p&&setTimeout(async()=>{try{const{getToken:o}=await C(async()=>{const{getToken:n}=await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-app-check.js");return{getToken:n}},[]),t=await o(p,!1);t&&t.token?e.success("‚úÖ App Check token obtenido (producci√≥n)"):e.warn("‚ö†Ô∏è  No fue posible obtener App Check token en producci√≥n")}catch(o){const t=o.code||"",n=o.message||"";n.includes("throttled")||t==="appCheck/throttled"?(e.warn("‚ö†Ô∏è  App Check: L√≠mite de solicitudes alcanzado (continuando sin App Check)"),c&&e.info("üí° Desarrollo: Visita /webapp/clear-appcheck-throttle.html para limpiar")):n.includes("403")||n.includes("recaptcha")||t==="appCheck/recaptcha-error"?(e.warn("‚ö†Ô∏è  App Check: ReCAPTCHA no disponible (continuando sin App Check)"),c&&(e.info("üí° Desarrollo: Configura dominio en Google Cloud Console"),e.info("   ‚Üí https://console.cloud.google.com/security/recaptcha"))):n.includes("400")?e.warn("‚ö†Ô∏è  App Check: Configuraci√≥n de ReCAPTCHA pendiente (continuando sin App Check)"):e.debug("App Check token error:",n)}},2e3)})();window.getAppCheckToken=async function(){if(!window._appCheckInstance)return e.error("App Check no est√° inicializado"),null;try{const{getToken:a}=await C(async()=>{const{getToken:o}=await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-app-check.js");return{getToken:o}},[]),c=await a(window._appCheckInstance,!1);return e.success("‚úÖ App Check Token obtenido"),c}catch(a){return e.error("‚ùå Error obteniendo token:",a.message||a),null}};typeof window<"u"&&(window.verifyRecaptchaScore=async function(a){return e.warn("üëª verifyRecaptchaScore (legacy/shim) invoked. Returning success mock."),console.trace("üîç Trace for verifyRecaptchaScore call:"),{success:!0,score:1,action:"shim_bypass"}});export{C as _};
