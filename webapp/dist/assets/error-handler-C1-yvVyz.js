import{l as n}from"./logger-CnI7WBtq.js";import{s as i}from"./utils-B649B8Z6.js";let c=!1;const t={count:0,lastError:null,lastErrorTime:0,resetInterval:6e4};function v(){if(c){n.warn("Global error handling already setup");return}n.info("Setting up global error handling"),window.onerror=p,window.onunhandledrejection=g,setInterval(()=>{t.count=0},t.resetInterval),c=!0,n.info("Global error handling setup complete")}function p(r,e,o,s,a){if(n.error("Uncaught error:",{message:r,source:e,lineno:o,colno:s,error:a,stack:a?.stack}),f(r))return n.debug("Duplicate error suppressed"),!0;switch(u(r,a)){case"firebase":l(a);break;case"network":d(a);break;case"script":h(r,e);break;default:w(r)}return!0}function g(r){const e=r.reason;if(n.error("Unhandled promise rejection:",{reason:e,promise:r.promise,stack:e?.stack}),f(e?.message||String(e))){n.debug("Duplicate rejection suppressed"),r.preventDefault();return}switch(u(e?.message,e)){case"firebase":l(e);break;case"network":d(e);break;default:m(e)}r.preventDefault()}function u(r,e){if(!r&&!e)return"unknown";const o=(r||e?.message||"").toLowerCase();return o.includes("firebase")||o.includes("firestore")||o.includes("auth/")||e?.code?.startsWith("auth/")||e?.code?.startsWith("firestore/")?"firebase":o.includes("network")||o.includes("fetch")||o.includes("timeout")||o.includes("cors")||e?.name==="NetworkError"?"network":o.includes("script")||o.includes("loading chunk")?"script":"generic"}function l(r){const e=r?.code||"",o=r?.message||"";n.error("Firebase error:",{code:e,message:o});const a={"auth/network-request-failed":"Error de conexión. Por favor, verifica tu internet.","auth/too-many-requests":"Demasiados intentos. Por favor, espera un momento.","auth/user-not-found":"Usuario no encontrado.","auth/wrong-password":"Contraseña incorrecta.","auth/email-already-in-use":"Este correo ya está registrado.","auth/weak-password":"La contraseña es muy débil.","auth/invalid-email":"Correo electrónico inválido.","permission-denied":"No tienes permisos para esta acción.",unavailable:"Servicio temporalmente no disponible. Intenta de nuevo."}[e]||"Error en la operación. Por favor, intenta de nuevo.";i(a,"error")}function d(r){n.error("Network error:",r),navigator.onLine?i("Error de red. Por favor, recarga la página.","error"):i("Sin conexión a internet. Verifica tu conexión.","error")}function h(r,e){n.error("Script error:",{message:r,source:e}),i("Error cargando recursos. Por favor, recarga la página.","error"),setTimeout(()=>{confirm("¿Deseas recargar la página para solucionar el problema?")&&window.location.reload()},3e3)}function w(r){n.error("Generic error:",r),t.count<3&&i("Ha ocurrido un error. Si persiste, recarga la página.","warning")}function m(r){n.error("Generic rejection:",r),t.count<3&&i("Error procesando solicitud. Intenta de nuevo.","error")}function f(r){const e=Date.now(),o=e-t.lastErrorTime;return t.lastError===r&&o<5e3?(t.count++,!0):(t.lastError=r,t.lastErrorTime=e,t.count++,!1)}typeof window<"u"&&(window.__errorTracker=t);export{v as s};
