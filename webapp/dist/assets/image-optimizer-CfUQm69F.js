import{l as o}from"./logger-CnI7WBtq.js";async function c(){if(!window.createImageBitmap)return!1;const t="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=";try{const e=await fetch(t).then(a=>a.blob());return(await createImageBitmap(e)).width===1}catch{return!1}}async function h(t,e=!1){return!t||typeof t!="string"||t.includes("firebasestorage.googleapis.com")&&(await c()||e),t}class b{constructor(e={}){this.options={root:null,rootMargin:e.rootMargin||"50px",threshold:e.threshold||.01,loadingClass:e.loadingClass||"lazy-loading",loadedClass:e.loadedClass||"lazy-loaded",errorClass:e.errorClass||"lazy-error"},this.observer=null,this.images=new Set,this.init()}init(){if(!("IntersectionObserver"in window)){o.warn("IntersectionObserver not supported, loading all images immediately");return}this.observer=new IntersectionObserver(e=>this.handleIntersection(e),{root:this.options.root,rootMargin:this.options.rootMargin,threshold:this.options.threshold}),o.info("LazyImageLoader initialized")}handleIntersection(e){e.forEach(s=>{s.isIntersecting&&this.loadImage(s.target)})}async loadImage(e){if(e.classList.contains(this.options.loadedClass))return;e.classList.add(this.options.loadingClass);const s=e.dataset.src,a=e.dataset.srcset;if(!s&&!a){o.warn("Image has no data-src or data-srcset",e),this.observer?.unobserve(e);return}try{const r=s?await h(s):null;await this.preloadImage(r||s),r&&(e.src=r),a&&(e.srcset=a),e.classList.remove(this.options.loadingClass),e.classList.add(this.options.loadedClass),this.observer?.unobserve(e),this.images.delete(e),o.debug("Image loaded:",s)}catch(r){o.error("Error loading image:",r,{src:s}),e.classList.remove(this.options.loadingClass),e.classList.add(this.options.errorClass),this.observer?.unobserve(e),this.images.delete(e)}}preloadImage(e){return new Promise((s,a)=>{const r=new Image;r.onload=()=>s(),r.onerror=a,r.src=e})}observe(e){if(!this.observer){this.loadImage(e);return}this.images.add(e),this.observer.observe(e)}observeAll(e){e.forEach(s=>this.observe(s))}unobserve(e){this.observer&&this.observer.unobserve(e),this.images.delete(e)}destroy(){this.observer&&(this.observer.disconnect(),this.observer=null),this.images.clear()}}function d(t={}){const e=new b(t),s=document.querySelectorAll("img[data-src], img[data-srcset]");return s.length>0&&(e.observeAll(s),o.info(`Lazy loading initialized for ${s.length} images`)),"MutationObserver"in window&&(new MutationObserver(r=>{r.forEach(l=>{l.addedNodes.forEach(i=>{if(i.nodeType===1){i.matches&&i.matches("img[data-src], img[data-srcset]")&&e.observe(i);const n=i.querySelectorAll?.("img[data-src], img[data-srcset]");n&&n.length>0&&e.observeAll(n)}})})}).observe(document.body,{childList:!0,subtree:!0}),o.debug("MutationObserver set up for dynamic lazy images")),e}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.lazyImageLoader=d()}):window.lazyImageLoader=d());
