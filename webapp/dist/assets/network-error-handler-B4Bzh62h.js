class a{constructor({maxAttempts:t=5,windowMs:e=6e4,keyPrefix:n="rate_limit"}={}){this.maxAttempts=t,this.windowMs=e,this.keyPrefix=n}_getKey(t){return`${this.keyPrefix}_${t}`}_getAttempts(t){const e=this._getKey(t),n=localStorage.getItem(e);if(!n)return[];try{const o=JSON.parse(n),r=Date.now();return o.filter(i=>r-i<this.windowMs)}catch{return[]}}_saveAttempts(t,e){const n=this._getKey(t);localStorage.setItem(n,JSON.stringify(e))}tryRequest(t){const e=this._getAttempts(t);return e.length>=this.maxAttempts?!1:(e.push(Date.now()),this._saveAttempts(t,e),!0)}getRemainingAttempts(t){const e=this._getAttempts(t);return Math.max(0,this.maxAttempts-e.length)}getRetryAfter(t){const e=this._getAttempts(t);if(e.length===0)return 0;const o=Math.min(...e)+this.windowMs,r=Date.now();return Math.ceil(Math.max(0,o-r)/1e3)}isRateLimited(t){return this._getAttempts(t).length>=this.maxAttempts}reset(t){const e=this._getKey(t);localStorage.removeItem(e)}clearAll(){const t=[];for(let e=0;e<localStorage.length;e++){const n=localStorage.key(e);n&&n.startsWith(this.keyPrefix)&&t.push(n)}t.forEach(e=>localStorage.removeItem(e))}}const v={login:new a({maxAttempts:5,windowMs:6e4,keyPrefix:"login"}),register:new a({maxAttempts:3,windowMs:3e5,keyPrefix:"register"}),passwordReset:new a({maxAttempts:3,windowMs:9e5,keyPrefix:"password_reset"}),sendMessage:new a({maxAttempts:10,windowMs:6e4,keyPrefix:"send_message"}),sendMatch:new a({maxAttempts:20,windowMs:36e5,keyPrefix:"send_match"}),search:new a({maxAttempts:30,windowMs:6e4,keyPrefix:"search"})};function x(s,t){const e=Math.floor(t/60),n=t%60;let o="";e>0?(o=`${e} minuto${e>1?"s":""}`,n>0&&(o+=` y ${n} segundo${n>1?"s":""}`)):o=`${n} segundo${n>1?"s":""}`;const r=`Demasiados intentos de ${s}. Por favor, espera ${o} antes de intentar nuevamente.`;typeof window.showToast=="function"?window.showToast(r,"warning"):alert(r)}const m=s=>!s||typeof s!="string"?!1:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.trim())&&s.length<=254,d=s=>{if(!s||typeof s!="string")return{isValid:!1,strength:0,errors:["Contrase침a requerida"]};const t=[];let e=0;return s.length<8?t.push("M칤nimo 8 caracteres"):e+=1,/[A-Z]/.test(s)?e+=1:t.push("Requiere al menos una may칰scula"),/[a-z]/.test(s)?e+=1:t.push("Requiere al menos una min칰scula"),/[0-9]/.test(s)?e+=1:t.push("Requiere al menos un n칰mero"),/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(s)?e+=1:t.push("Requiere al menos un car치cter especial"),["password","12345678","qwerty","admin"].some(o=>s.toLowerCase().includes(o))&&(t.push("Contrase침a demasiado com칰n"),e=Math.max(0,e-2)),{isValid:t.length===0,strength:Math.min(5,e),errors:t}},g=s=>{if(!s||typeof s!="string")return!1;const t=s.replace(/[\s\-()]/g,""),e=/^[6789]\d{8}$/,n=/^\+34[6789]\d{8}$/;return e.test(t)||n.test(t)},p=s=>{if(!s)return!1;const t=new Date,e=new Date(s);if(isNaN(e.getTime()))return!1;let n=t.getFullYear()-e.getFullYear();const o=t.getMonth()-e.getMonth();return(o<0||o===0&&t.getDate()<e.getDate())&&n--,n>=18&&n<=120},f=s=>{if(!s||typeof s!="string")return!1;const t=/^[a-zA-Z0-9_-]{3,20}$/,e=["admin","root","system"],n=s.toLowerCase();return t.test(s)&&!e.some(o=>n.includes(o))},h=s=>{if(!s||typeof s!="string")return!1;try{const t=new URL(s);return t.protocol==="http:"||t.protocol==="https:"}catch{return!1}},y=s=>{if(!s||typeof s!="string")return!1;const t=s.replace(/\s/g,"");if(!/^\d{13,19}$/.test(t))return!1;let e=0,n=!1;for(let o=t.length-1;o>=0;o--){let r=parseInt(t[o],10);n&&(r*=2,r>9&&(r-=9)),e+=r,n=!n}return e%10===0},w=s=>{if(!s||typeof s!="string")return!1;const t=s.toUpperCase().replace(/[\s-]/g,""),e=/^(\d{8})([A-Z])$/,n=/^([XYZ])(\d{7})([A-Z])$/;let o=t.match(e),r;if(o)r=parseInt(o[1],10);else{if(o=t.match(n),!o)return!1;const u={X:0,Y:1,Z:2}[o[1]];r=parseInt(u+o[2],10)}const l="TRWAGMYFPDXBNJZSQVHLCKE"[r%23],c=o[o.length-1];return l===c},R={email:m,password:d,phone:g,age:p,username:f,url:h,creditCard:y,dni:w};function M(s,t="operation"){const e={code:s.code,message:s.message,operation:t,timestamp:new Date().toISOString(),userMessage:"",recoveryOptions:[],severity:"error",shouldRetry:!1,isDomainIssue:!1};if(s.code==="auth/network-request-failed"){const n=location.hostname;n.includes(".vercel.app")?(e.userMessage="Error de conexi칩n con Firebase. El dominio de despliegue puede no estar autorizado.",e.recoveryOptions=["Verifica que el dominio est칠 autorizado en Firebase Console","Prueba en modo localhost para desarrollo","Contacta al administrador para autorizar el dominio","Intenta nuevamente en unos segundos"],e.isDomainIssue=!0):n==="localhost"||n==="127.0.0.1"?(e.userMessage="Error de conexi칩n. Verifica que est칠s conectado a internet.",e.recoveryOptions=["Verifica tu conexi칩n a internet","Aseg칰rate de no estar detr치s de un firewall restrictivo","Intenta desactivar VPN si est치s usando una","Prueba con un navegador diferente"]):(e.userMessage="Error de conexi칩n. No podemos comunicarnos con nuestros servidores.",e.recoveryOptions=["Verifica tu conexi칩n a internet","Intenta nuevamente en unos segundos","Prueba con una conexi칩n diferente","Contacta soporte si el problema persiste"]),e.severity="error",e.shouldRetry=!0}else if(s.code==="auth/internal-error"){e.userMessage="Error interno del servidor. Estamos trabajando para solucionarlo.",e.recoveryOptions=["Intenta nuevamente en unos minutos","Recarga la p치gina","Contacta soporte si el problema persiste"],e.severity="error",e.shouldRetry=!0;const n=(s.message||"").toLowerCase();(n.includes("<html")||n.includes("page not found")||n.includes("http cloud function returned an error"))&&(e.isDomainIssue=!0)}else s.code==="auth/timeout"?(e.userMessage="La solicitud tard칩 demasiado tiempo. El servidor no respondi칩.",e.recoveryOptions=["Verifica tu conexi칩n a internet","Intenta nuevamente","Prueba m치s tarde"],e.severity="warning",e.shouldRetry=!0):s.code==="auth/unavailable"?(e.userMessage="El servicio de autenticaci칩n no est치 disponible temporalmente.",e.recoveryOptions=["El servicio podr칤a estar en mantenimiento","Intenta nuevamente en unos minutos","Consulta nuestro estado de servicio"],e.severity="warning",e.shouldRetry=!0):(e.userMessage=`Error durante ${t}. Por favor, intenta nuevamente.`,e.recoveryOptions=["Verifica los datos ingresados","Intenta nuevamente","Contacta soporte si el problema persiste"],e.severity="error",e.shouldRetry=!1);return console.error(`[NETWORK ERROR] ${t}:`,{code:e.code,message:e.message,timestamp:e.timestamp,userAgent:navigator.userAgent,online:navigator.onLine,hostname:location.hostname,protocol:location.protocol}),e}function A(s,t){s.severity;let e=s.userMessage;s.recoveryOptions.length>0&&(e+=`

游눠 Sugerencias:`,s.recoveryOptions.forEach((n,o)=>{e+=`
${o+1}. ${n}`})),s.shouldRetry&&(e+=`

游댃 Puedes intentar nuevamente.`),t(e,s.severity)}export{v as R,A as a,M as h,x as s,R as v};
