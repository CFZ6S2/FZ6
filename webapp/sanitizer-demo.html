<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ejemplo - Sanitizer XSS Protection</title>

  <!-- DOMPurify para sanitizaci√≥n XSS -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.8/dist/purify.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }

    .example-box {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .vulnerable { border-left: 4px solid #e74c3c; }
    .safe { border-left: 4px solid #27ae60; }

    h2 { color: #333; }
    h3 { color: #666; }

    code {
      background: #f8f8f8;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
    }

    .input-group {
      margin: 15px 0;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    input, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    button {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
    }

    button:hover {
      background: #2980b9;
    }

    button.danger {
      background: #e74c3c;
    }

    button.danger:hover {
      background: #c0392b;
    }

    button.success {
      background: #27ae60;
    }

    button.success:hover {
      background: #229954;
    }

    .output {
      margin-top: 15px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 4px;
      min-height: 60px;
    }

    .warning {
      background: #fff3cd;
      border: 1px solid #ffc107;
      color: #856404;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
    }

    .success-msg {
      background: #d4edda;
      border: 1px solid #28a745;
      color: #155724;
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <h1>üõ°Ô∏è Ejemplo de Sanitizaci√≥n XSS</h1>
  <p>Esta p√°gina demuestra c√≥mo usar el sanitizer para prevenir ataques XSS.</p>

  <!-- Ejemplo 1: innerHTML Vulnerable -->
  <div class="example-box vulnerable">
    <h2>‚ùå Ejemplo 1: innerHTML SIN Sanitizar (VULNERABLE)</h2>
    <p><strong>‚ö†Ô∏è PELIGRO:</strong> Este ejemplo muestra c√≥mo NO hacer las cosas.</p>

    <div class="input-group">
      <label>Ingresa c√≥digo malicioso (ej: &lt;img src=x onerror="alert('XSS')"&gt;):</label>
      <textarea id="vulnerable-input" rows="3" placeholder="<script>alert('XSS')</script>"></textarea>
    </div>

    <button class="danger" onclick="testVulnerable()">
      Probar sin Sanitizar (PELIGROSO)
    </button>

    <div class="output" id="vulnerable-output"></div>

    <div class="warning">
      ‚ö†Ô∏è Este m√©todo es vulnerable a XSS. NUNCA uses innerHTML con contenido de usuario sin sanitizar.
    </div>
  </div>

  <!-- Ejemplo 2: innerHTML con Sanitizer -->
  <div class="example-box safe">
    <h2>‚úÖ Ejemplo 2: innerHTML CON Sanitizer (SEGURO)</h2>
    <p><strong>‚úÖ SEGURO:</strong> Usando el sanitizer para limpiar el HTML.</p>

    <div class="input-group">
      <label>Ingresa el mismo c√≥digo malicioso:</label>
      <textarea id="sanitized-input" rows="3" placeholder="<script>alert('XSS')</script>"></textarea>
    </div>

    <button class="success" onclick="testSanitized()">
      Probar con Sanitizer (SEGURO)
    </button>

    <div class="output" id="sanitized-output"></div>

    <div class="success-msg">
      ‚úÖ El sanitizer bloquea c√≥digo malicioso pero permite HTML seguro como &lt;b&gt;negrita&lt;/b&gt;
    </div>
  </div>

  <!-- Ejemplo 3: textContent -->
  <div class="example-box safe">
    <h2>‚úÖ Ejemplo 3: textContent (M√ÅS SEGURO)</h2>
    <p><strong>‚úÖ M√ÅS SEGURO:</strong> Usando textContent para texto plano.</p>

    <div class="input-group">
      <label>Ingresa cualquier texto:</label>
      <textarea id="text-input" rows="3" placeholder="Cualquier texto, incluso con <tags>"></textarea>
    </div>

    <button class="success" onclick="testTextContent()">
      Probar con textContent
    </button>

    <div class="output" id="text-output"></div>

    <div class="success-msg">
      ‚úÖ textContent convierte TODO a texto plano. Es la opci√≥n m√°s segura si no necesitas HTML.
    </div>
  </div>

  <!-- Ejemplo 4: URLs -->
  <div class="example-box safe">
    <h2>‚úÖ Ejemplo 4: Validaci√≥n de URLs</h2>
    <p><strong>‚úÖ SEGURO:</strong> Validando URLs para prevenir javascript: y data: URIs.</p>

    <div class="input-group">
      <label>Prueba estas URLs (javascript:alert('XSS'), data:text/html,&lt;script&gt;, http://example.com):</label>
      <input type="text" id="url-input" placeholder="javascript:alert('XSS')">
    </div>

    <button class="success" onclick="testURL()">
      Validar URL
    </button>

    <div class="output" id="url-output"></div>
  </div>

  <!-- Script -->
  <script type="module">
    import { sanitizer } from './js/sanitizer.js';

    // Hacer sanitizer disponible globalmente para los ejemplos
    window.sanitizer = sanitizer;

    console.log('‚úÖ Sanitizer cargado correctamente');

    // Auto-llenar con ejemplos de XSS
    document.getElementById('vulnerable-input').value = '<img src=x onerror="alert(\'XSS Vulnerable!\')">';
    document.getElementById('sanitized-input').value = '<img src=x onerror="alert(\'XSS Bloqueado!\')">';
    document.getElementById('text-input').value = '<script>alert("Esto se mostrar√° como texto")</script>';
    document.getElementById('url-input').value = 'javascript:alert("XSS")';
  </script>

  <script>
    // Ejemplo 1: VULNERABLE (NO HACER ESTO)
    function testVulnerable() {
      const input = document.getElementById('vulnerable-input').value;
      const output = document.getElementById('vulnerable-output');

      // ‚ùå NUNCA HAGAS ESTO
      output.innerHTML = input;

      console.warn('‚ö†Ô∏è innerHTML vulnerable usado:', input);
    }

    // Ejemplo 2: Con Sanitizer
    function testSanitized() {
      const input = document.getElementById('sanitized-input').value;
      const output = document.getElementById('sanitized-output');

      // ‚úÖ Sanitizar antes de usar innerHTML
      const safe = window.sanitizer.html(input);
      output.innerHTML = safe;

      console.log('‚úÖ HTML sanitizado:', {
        original: input,
        sanitized: safe
      });
    }

    // Ejemplo 3: textContent
    function testTextContent() {
      const input = document.getElementById('text-input').value;
      const output = document.getElementById('text-output');

      // ‚úÖ textContent es siempre seguro
      output.textContent = window.sanitizer.text(input);

      console.log('‚úÖ Texto sanitizado:', input);
    }

    // Ejemplo 4: URL Validation
    function testURL() {
      const input = document.getElementById('url-input').value;
      const output = document.getElementById('url-output');

      const safeUrl = window.sanitizer.url(input);

      if (safeUrl) {
        output.innerHTML = `
          <div class="success-msg">
            <strong>‚úÖ URL V√°lida:</strong><br>
            <a href="${safeUrl}" target="_blank">${safeUrl}</a>
          </div>
        `;
        console.log('‚úÖ URL v√°lida:', safeUrl);
      } else {
        output.innerHTML = `
          <div class="warning">
            <strong>‚ùå URL Bloqueada:</strong><br>
            "${input}" contiene un protocolo peligroso o es inv√°lida.
          </div>
        `;
        console.warn('‚ùå URL bloqueada:', input);
      }
    }
  </script>
</body>
</html>
